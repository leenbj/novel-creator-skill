# 📖 小说创作大师 (Novel Creator) v5.1

## 简介

完整的小说创作工作流系统，集成**文件级长期记忆**，支持百万字级长篇小说的持续创作。
核心理念：**上下文窗口 = 内存（易失）；文件系统 = 磁盘（持久）**——所有重要信息写入文件，而非依赖对话记忆。

---

## 🧠 长期记忆系统

### 设计原理

借鉴 [planning-with-files](https://github.com/OthmanAdi/planning-with-files) 的文件级持久记忆模式：
- **Smart State 模式**：`novel_state.md` 为唯一必读文件，内含各追踪器摘要
- **三核心文件**：novel_plan / novel_state / novel_findings 构成记忆骨架
- **五追踪器文件**：角色、时间线、伏笔、世界状态、风格锚点
- **滚动压缩摘要**：章节摘要按距离递减压缩，确保200万字仍可回溯
- **注意力钩子**：写前必读、写后必更新，防止剧情漂移

### 记忆文件架构

```
novel_project_{name}/
├── 00_memory/                          # 🧠 长期记忆系统
│   ├── novel_plan.md                   # 主线计划（写前必读）
│   ├── novel_state.md                  # 当前状态（写前必读·Smart State）
│   ├── novel_findings.md               # 发现与修正记录
│   ├── character_tracker.md            # 全角色状态追踪
│   ├── timeline.md                     # 时间线事件表
│   ├── foreshadowing_tracker.md        # 伏笔追踪器
│   ├── world_state.md                  # 世界/势力/力量体系状态
│   ├── style_anchor.md                 # 风格锚点（风格DNA+对话画像+节奏）
│   └── chapter_summaries/              # 滚动章节摘要
│       ├── recent.md                   # 最近10章详细摘要（L1）
│       ├── mid_term.md                 # 11-50章中等摘要（L2）
│       └── archive/                    # 50章前压缩存档（L3）
│           ├── vol01_001-050.md
│           └── ...
│
├── 01_analysis/                        # 拆书分析报告
│   ├── 拆书报告.md
│   ├── 四维分析.md
│   └── 仿写指南.md
│
├── 02_knowledge_base/                  # 知识库（12个模块）
│   ├── 01_brainstorm.md               # 脑洞库
│   ├── 02_titles.md                   # 书名库
│   ├── 03_intro.md                    # 简介库
│   ├── 04_outline.md                  # 大纲库
│   ├── 05_detailed_outline.md         # 细纲库
│   ├── 06_golden_finger.md            # 金手指库
│   ├── 07_opening.md                  # 开篇库
│   ├── 08_characters.md               # 人物库
│   ├── 09_names.md                    # 名字库
│   ├── 10_worldbuilding.md            # 世界观库
│   ├── 11_templates.md                # 模板库
│   └── 99_index.md                    # 知识库索引
│
├── 03_manuscript/                      # 正文章节
│   ├── 第001章_XXXXXX.md
│   ├── 第002章_XXXXXX.md
│   └── ...
│
├── 04_editing/                         # 校稿记录
│   ├── 校稿报告/
│   └── 去AI化版本/
│
└── 05_assets/                          # 辅助资源
    ├── 素材/
    └── 参考/
```

---

## 🔁 三核心记忆文件详解

### 1. novel_plan.md（主线计划）

**作用**：防止剧情偏离主线，等同于 task_plan.md

**内容结构**：
```markdown
# 小说主线计划

## 核心设定（不可偏离）
- 书名：
- 类型：
- 核心卖点（一句话）：
- 终极结局：

## 主线大纲
- [ ] 第一卷：[卷名] - [核心事件] (第1-50章)
  - [ ] 第一幕：[目标]
  - [ ] 第二幕：[冲突升级]
  - [ ] 第三幕：[高潮与转折]
- [ ] 第二卷：[卷名] - [核心事件] (第51-100章)
  ...

## 核心人物弧线
- 主角：[起点状态] → [中期转变] → [终极形态]
- 女主/重要配角：...

## 力量体系阶梯
[等级1] → [等级2] → ... → [最高等级]

## 绝对规则（红线）
1. [不可违反的设定1]
2. [不可违反的设定2]
...
```

**规则**：此文件在知识库构建时创建，后续只允许用户明确同意后修改。

### 2. novel_state.md（Smart State·核心状态文件）

**作用**：提供即时上下文，**唯一的写前必读状态文件**。内含各追踪器的关键摘要，无需逐一读取追踪器。

**内容结构**：
```markdown
# 当前写作状态

## 进度
- 当前章节：第X章
- 当前卷：第X卷
- 总字数：约XX万字
- 最后更新：YYYY-MM-DD

## 当前活跃剧情线
1. [主线] 描述...（进展：XX%）
2. [支线A] 描述...（进展：XX%）

## 当前活跃人物摘要
| 人物 | 当前状态 | 所在位置 | 当前目标 | 最近变化 |
|------|---------|---------|---------|---------|
| 主角 | ... | ... | ... | 第X章：[变化] |
| 角色A | ... | ... | ... | 第X章：[变化] |

## 待回收伏笔（紧急度排序）
1. 🔴 [伏笔内容] - 埋设于第X章，预计第Y章回收，已超期Z章
2. 🟡 [伏笔内容] - 埋设于第X章，可延后
3. 🟢 [伏笔内容] - 长线伏笔

## 最近5章摘要
- 第X-4章：[一句话摘要]
- 第X-3章：[一句话摘要]
- 第X-2章：[一句话摘要]
- 第X-1章：[一句话摘要]
- 第X章（最新）：[一句话摘要]

## 情感节奏快照
最近5章节奏：[缓→升→升→爆→缓]
下一章建议节奏：[缓/升/爆]

## 风格提醒
- 本章注意事项：[从style_anchor.md摘取的关键提醒]
- 禁忌表达：[最近高频出现需避免的表达]

## 下一章预告
- 章节号：第X+1章
- 计划内容：
- 涉及人物：
- 需要回收的伏笔：
- 章末钩子设计：[本章结尾应留的悬念/钩子]
```

**规则**：每章写完后**必须**更新此文件。此文件是 Pre-Write 的核心读取对象。

### 3. novel_findings.md（发现与修正）

**作用**：记录错误和修正，防止重复犯错

**内容结构**：
```markdown
# 写作发现与修正记录

## 一致性问题（已修正）
| 发现时间 | 章节 | 问题描述 | 修正方案 | 状态 |
|----------|------|---------|---------|------|

## 设定补充（写作中确认）
| 时间 | 新增设定 | 来源章节 | 已同步到知识库 |
|------|---------|---------|--------------|

## 风格偏离记录
| 时间 | 偏离描述 | 修正措施 |
|------|---------|---------|

## 绝不重复的错误
1. ❌ [具体错误描述和原因]
...
```

---

## ⚡ 钩子行为规则（MANDATORY）

### Pre-Write Protocol（写章节前）

采用 **Smart State 模式**，最小化必读文件数量：

```
必读文件（2个）：
  步骤1: Read novel_plan.md → 确认主线方向和当前卷目标
  步骤2: Read novel_state.md → Smart State 一站式获取：
         进度 + 活跃人物 + 待回收伏笔 + 近章摘要 + 节奏 + 风格提醒

按需读取（仅在需要时）：
  - 本章涉及复杂角色互动 → Read character_tracker.md 获取完整档案
  - 本章涉及时间跳跃 → Read timeline.md 校验时间线
  - 本章需回收伏笔 → Read foreshadowing_tracker.md 获取详情
  - 本章涉及新地点/势力 → Read world_state.md 获取完整设定
  - 本章是重要战斗/情感场景 → Read style_anchor.md 校准风格
  - 需要更多上下文 → Read chapter_summaries/recent.md
  - 涉及具体设定 → Read 02_knowledge_base/ 中相关文件
```

读取完成后输出：
```
📋 写前检查清单：
- 当前进度：第X章
- 本章计划：[简述]
- 涉及人物：[列表]
- 待回收伏笔：[有/无，具体内容]
- 节奏建议：[缓/升/爆]
- 章末钩子：[计划的章末悬念]
- 一致性确认：✅ 无冲突 / ⚠️ 需注意[具体事项]
```

### Post-Write Protocol（写完章节后）

每章写完后，**必须**执行以下更新：

```
步骤1: 提取本章核心记忆（结构化摘要）
步骤2: 更新 novel_state.md（Smart State 全量更新）：
       - 进度、活跃剧情、活跃人物摘要
       - 待回收伏笔列表
       - 最近5章摘要（滚动更新）
       - 情感节奏快照
       - 风格提醒
       - 下一章预告（含章末钩子设计）
步骤3: 更新受影响的追踪器（并行）：
       - character_tracker.md（如有角色状态变化）
       - timeline.md（如有新事件）
       - foreshadowing_tracker.md（如有伏笔变动）
       - world_state.md（如有新设定揭示）
       - style_anchor.md 情感节奏表（追加本章记录）
步骤4: 更新 chapter_summaries/recent.md（追加L1摘要）
步骤5: 执行一致性检查 → 问题记录到 novel_findings.md
步骤6: 更新 novel_plan.md 中的进度checkbox
```

更新完成后输出：
```
📝 写后更新报告：
- 本章字数：X字
- 新增人物：[有/无]
- 新增伏笔：[有/无，具体]
- 回收伏笔：[有/无，具体]
- 章末钩子：[本章结尾留下的悬念]
- 情感基调：[本章情感标记]
- 一致性检查：✅ 通过 / ⚠️ 发现问题[具体]
- 记忆文件已更新：✅
```

### 2-Chapter Rule（双章审计）

每写完 **2章**，执行一次全面一致性审计：

```
1. 对比最近2章内容与 character_tracker.md → 角色行为一致性
2. 对比最近2章内容与 world_state.md → 设定一致性
3. 检查 foreshadowing_tracker.md → 是否有超期未回收的伏笔
4. 检查 novel_plan.md → 剧情是否偏离主线
5. 检查 style_anchor.md → 风格是否偏离（句式、对话、节奏）
6. 输出审计报告，问题记录到 novel_findings.md
```

### Session Recovery（会话恢复）

当用户执行 `/clear` 或开始新会话后：

```
1. 检测项目目录是否存在 00_memory/
2. 如果存在：
   a. 读取 novel_plan.md → 恢复主线认知
   b. 读取 novel_state.md → 恢复全部当前状态（Smart State）
   c. 读取 novel_findings.md → 恢复注意事项
3. 输出恢复报告：
   "📖 会话已恢复！当前进度：第X章，上次写作内容：[摘要]"
4. 询问用户：继续写下一章 / 修改上一章 / 其他操作
```

---

## 📊 章节摘要压缩策略

解决百万字级记忆的关键：**滚动压缩**。

### 摘要层级

| 层级 | 范围 | 详细度 | 单章字数 | 存储位置 |
|------|------|--------|---------|---------|
| L1 详细 | 最近10章 | 完整摘要 | 300-500字 | recent.md |
| L2 中等 | 11-50章前 | 关键事件 | 100-200字 | mid_term.md |
| L3 压缩 | 50章前 | 卷级总结 | 每卷1000字 | archive/volXX.md |

### 压缩触发规则

- **每写完1章**：生成L1摘要，追加到 recent.md
- **每写完10章**：将 recent.md 中最早的章节压缩为L2，移入 mid_term.md
- **每写完50章**：将 mid_term.md 中最早的40章压缩为L3卷级总结，移入 archive/

### 摘要提取模板

每章摘要必须包含：
```markdown
## 第XXX章：[章节标题]
- **核心事件**：[一句话描述本章最重要的事]
- **人物变化**：[哪些角色状态发生了变化]
- **新增设定**：[本章揭示的新信息]
- **伏笔**：[新埋设/回收的伏笔]
- **情感基调**：[本章的情绪走向]
- **承上**：[与上章的衔接点]
- **启下**：[为下章铺垫的内容]
- **关键对话/台词**：[值得记住的对话]
```

---

## 📚 追踪器文件详解

### character_tracker.md（角色追踪器）

追踪所有角色的完整档案。novel_state.md 中仅保留活跃角色摘要，完整信息在此。

```markdown
## 主角：[名字]
- 当前境界/实力：
- 当前位置：
- 当前目标：
- 持有物品/资源：
- 性格特征：
- 外貌特征：
- 关键关系：
- 最近变化（最新3条）：

## 核心配角
### [角色名A]
- 身份：
- 与主角关系：
- 当前状态：
- 最近出场：第X章
- 最近变化：

## 已退场角色（存档）
| 角色 | 退场章节 | 退场原因 | 是否可能回归 |
```

### timeline.md（时间线）

```markdown
## 时间体系
[说明本小说的时间计量方式]

### 第一卷：[卷名]
| 故事时间 | 章节 | 事件 | 影响 |
```

### foreshadowing_tracker.md（伏笔追踪器）

```markdown
## 🔴 紧急回收（已超期或即将到期）
| ID | 伏笔内容 | 埋设章节 | 预期回收 | 当前章节 | 超期章数 |

## 🟡 活跃伏笔（进行中）
| ID | 伏笔内容 | 埋设章节 | 预期回收 | 关联剧情 | 回收方式提示 |

## 🟢 长线伏笔（可延后）
| ID | 伏笔内容 | 埋设章节 | 预期回收 | 备注 |

## ✅ 已回收伏笔（存档）
| ID | 伏笔内容 | 埋设章节 | 回收章节 | 回收方式 | 效果评估 |
```

### world_state.md（世界状态）

```markdown
## 力量体系当前状态
[当前已揭示的等级和规则]

## 势力分布
| 势力名 | 实力等级 | 与主角关系 | 当前状态 | 最近变化章节 |

## 地理位置
[当前已出现的地点和主角行踪]

## 重要物品/资源
| 物品名 | 持有者 | 功能 | 获得章节 | 当前状态 |

## 已揭示的秘密/真相
| 内容 | 揭示章节 | 知情角色 | 影响范围 |
```

### style_anchor.md（风格锚点）🆕

```markdown
## 风格DNA
- 叙事视角、句式特征、语言风格

## 风格样本
- 3-5段代表性文字样本

## 角色对话画像
- 每个核心角色的说话方式：口头禅、语气、习惯、称呼、情绪变化时的表现

## 情感节奏图
- 章节情感标记表：基调、紧张度(1-10)、节奏类型
- 节奏规则：连续高潮上限、低谷缓冲、节奏模式

## 禁忌清单（去AI化红线）
- 禁止句式、禁止词汇及替代方案

## 风格校准记录
- 每10章校准一次
```

---

## 🎯 核心功能模块

### 阶段一：拆书分析（/拆书）
深度拆解小说，提取金手指、爽点、人设、开篇四大维度。

### 阶段二：仿写学习（/仿写）
基于拆书结果，提取可复用的写作模板和技巧。同时提取风格DNA写入 style_anchor.md。

### 阶段三：知识库构建（/建库）
生成12个知识库模块 + 初始化全部记忆文件。

**关键**：建库时同步初始化 `00_memory/` 下所有文件：
1. 从大纲生成 novel_plan.md（含checkbox进度追踪）
2. 初始化 novel_state.md（Smart State 起始状态）
3. 初始化空的 novel_findings.md
4. 从人物库生成 character_tracker.md
5. 初始化空的 timeline.md
6. 初始化空的 foreshadowing_tracker.md
7. 从世界观库生成 world_state.md
8. 从仿写分析初始化 style_anchor.md（风格DNA + 对话画像 + 禁忌清单）
9. 初始化空的 chapter_summaries/

### 阶段四：小说生成（/写作）
基于知识库 + 记忆系统生成章节，严格执行 Pre-Write 和 Post-Write Protocol。

### 阶段五：批量写作（/批量写作）🆕
连续生成多个章节，每章之间自动执行 Post-Write → Pre-Write 循环：

```
/批量写作 第11章-第15章

流程：
  For each chapter in range:
    1. Pre-Write Protocol
    2. 生成章节内容
    3. Post-Write Protocol
    4. 压缩触发检查
  End
  全量一致性审计（2-Chapter Rule 按需触发）
```

### 阶段六：修改章节（/修改章节）🆕
修改已写章节并级联更新所有受影响的记忆文件：

```
/修改章节 第15章

流程：
  1. 读取原章节 + 原章节摘要
  2. 用户提供修改指令
  3. 生成修改后版本
  4. Diff 对比：识别变化的人物/伏笔/设定/时间线
  5. 级联更新所有受影响的记忆文件
  6. 检查后续章节是否受影响 → 输出影响报告
```

### 阶段七：记忆更新（/更新记忆）
手动触发全面记忆更新和一致性审计。

### 阶段八：校稿编辑（/校稿）
专业校稿和去AI化润色。

---

## 🚀 快速命令

| 命令 | 功能 | 说明 |
|------|------|------|
| `/拆书` | 拆书分析 | 四维分析目标小说 |
| `/仿写` | 仿写学习 | 提取写作模板 + 风格DNA |
| `/建库` | 构建知识库 | 生成12个知识库 + 初始化全部记忆文件（含style_anchor） |
| `/写作` | 生成章节 | 执行完整的 Pre/Post-Write Protocol |
| `/续写` | 继续写作 | 会话恢复 + 写下一章 |
| `/批量写作` | 批量生成 | 连续生成多章，自动循环记忆协议 |
| `/修改章节` | 章节修订 | 修改已写章节 + 级联更新记忆文件 |
| `/更新记忆` | 更新记忆 | 全面更新所有记忆文件 |
| `/检查一致性` | 一致性审计 | 全面检查剧情/人物/设定/风格一致性 |
| `/检索记忆` | 检索记忆 | 按关键词搜索记忆文件 |
| `/伏笔状态` | 伏笔报告 | 查看所有伏笔的当前状态 |
| `/角色状态` | 角色报告 | 查看所有角色的当前状态 |
| `/时间线` | 时间线报告 | 查看完整时间线 |
| `/风格校准` | 风格校准 | 对比当前写作与风格锚点，纠正偏离 |
| `/校稿` | 校稿编辑 | 支持全面/快速/去AI/精修模式 |
| `/完整流程` | 全流程 | 拆书→仿写→建库→写作 |

---

## 📖 使用教程

### 场景一：从零开始创作长篇小说

```
你：/建库
Claude：请描述您的小说创意...
你：我想写一本关于[创意]的小说

Claude：【生成12个知识库模块】
        【初始化记忆系统（含风格锚点）】
        ✅ 知识库已生成：02_knowledge_base/ (12个文件)
        ✅ 记忆系统已初始化：00_memory/ (8个文件 + chapter_summaries/)

        📋 初始记忆状态：
        - novel_plan.md：主线大纲已录入
        - character_tracker.md：X个角色已录入
        - world_state.md：世界设定已录入
        - style_anchor.md：风格DNA已锚定

        可以开始写作了！输入 /写作 开始第一章。
```

### 场景二：写作章节（Smart State 模式）

```
你：/写作 第11章

Claude：📋 执行 Pre-Write Protocol（Smart State）...
        ✅ 读取 novel_plan.md → 当前在第一卷第三幕
        ✅ 读取 novel_state.md → 一站式状态加载完成
        📌 按需加载：character_tracker.md（本章涉及复杂角色互动）

        📋 写前检查清单：
        - 当前进度：第11章
        - 本章计划：主角突破境界
        - 涉及人物：主角、师父、对手
        - 待回收伏笔：第5章"神秘玉佩发光"
        - 节奏建议：升（上章为缓）
        - 章末钩子：计划留下对手身份悬念
        - 一致性确认：✅ 无冲突

        【开始生成第11章...】

        [生成的小说内容]

        📝 执行 Post-Write Protocol...
        ✅ novel_state.md 已全量更新（Smart State）
        ✅ character_tracker.md 已更新（主角境界提升）
        ✅ timeline.md 已更新（+1事件）
        ✅ foreshadowing_tracker.md 已更新（回收1个，新增1个）
        ✅ style_anchor.md 情感节奏表已追加
        ✅ recent.md 已追加L1摘要
        ✅ 一致性检查通过

        📝 写后更新报告：
        - 本章字数：3500字
        - 章末钩子：对手摘下面具露出熟悉面孔
        - 情感基调：紧张→震撼（紧张度8/10）
        - 新增伏笔：1个（主角突破时的异象）
        - 回收伏笔：1个（神秘玉佩→传承信物）
        - 一致性检查：✅ 通过
```

### 场景三：批量写作

```
你：/批量写作 第12章-第15章

Claude：📋 批量写作模式启动（第12-15章）

        --- 第12章 ---
        [Pre-Write → 生成 → Post-Write]
        ✅ 第12章完成（3200字）

        --- 第13章 ---（自动触发2-Chapter Rule审计）
        [审计报告：✅ 通过]
        [Pre-Write → 生成 → Post-Write]
        ✅ 第13章完成（3800字）
        📊 压缩触发：recent.md 最早2章已压缩为L2

        --- 第14章 ---
        [Pre-Write → 生成 → Post-Write]
        ✅ 第14章完成（3100字）

        --- 第15章 ---（自动触发2-Chapter Rule审计）
        [审计报告：⚠️ 发现1个时间线问题 → 已修正]
        [Pre-Write → 生成 → Post-Write]
        ✅ 第15章完成（3600字）

        📊 批量写作完成！
        - 总计：4章，13700字
        - 伏笔：新增3个，回收1个
        - 一致性问题：1个（已自动修正）
```

### 场景四：修改已写章节

```
你：/修改章节 第15章

Claude：📖 读取第15章原文和摘要...

        当前第15章摘要：[摘要内容]

        请描述需要修改的内容：

你：把对手从"使用火焰术"改为"使用冰霜术"

Claude：📝 修改分析：
        - 变化项：对手战斗技能（火焰→冰霜）
        - 影响范围：
          - character_tracker.md：对手能力描述
          - world_state.md：已揭示的力量体系应用
          - 第15章摘要
          - 后续章节检查：第16章有引用吗？→ 是，需要同步修改

        【生成修改后的第15章】
        【级联更新所有受影响文件】

        ✅ 修改完成！影响报告：
        - 第15章已修改
        - character_tracker.md 已更新
        - world_state.md 已更新
        - chapter_summaries 已更新
        - ⚠️ 第16章第3段引用了"火焰"，需要手动确认是否修改
```

---

## 🔧 高级功能

### 1. 智能偏离纠正

当用户输入的写作指令与记忆文件冲突时，系统会主动提醒：

```
你：写第25章，让角色A使用传送术逃跑

Claude：⚠️ 一致性警告！
        根据 character_tracker.md，角色A 在第18章中失去了传送能力。

        建议方案：
        1. 角色A 使用其他方式逃跑（推荐）
        2. 添加情节解释角色A 恢复了传送能力
        3. 忽略警告，按原指令写作（将记录到 findings.md）

        请选择：
```

### 2. 伏笔到期提醒

当伏笔接近预期回收章节时自动提醒：

```
📋 写前检查 - 伏笔提醒：
🔴 紧急：伏笔#3"黑衣人身份"已超期5章！（第10章埋设，预期第20章，当前第25章）
🟡 提醒：伏笔#7"古老预言"距预期回收还有3章
```

### 3. 章末钩子追踪

每章结尾必须设计读者留存钩子，并在下一章开头回应：

```
第15章末尾钩子：对手摘下面具 → 第16章开头必须揭示/回应此悬念
```

### 4. 风格校准（/风格校准）

对比当前写作与 style_anchor.md 中的风格DNA：

```
📊 风格校准报告（基于最近10章）：
- 句式：⚠️ 长句比例偏高（当前4:6，目标3:7）
- 对话：✅ 对话占比正常（35%）
- 修辞密度：⚠️ 偏高，建议减少比喻
- 禁忌词检查：❌ "不禁"出现4次，建议替换
- 角色A对话：⚠️ 语气过于正式，应更口语化
```

### 5. 知识库索引联动

所有知识库文件通过 `99_index.md` 进行索引，写作时自动检查设定冲突。

### 6. 用户片段融合

用户可以提供自己的写作片段，系统会分析风格并融合到生成内容中。

---

## 📖 校稿编辑器（/校稿）

### 校稿模式

| 模式 | 命令 | 适用场景 | 检查项 |
|------|------|---------|--------|
| **全面校稿** | `/校稿 全面` | 重要章节 | 全部7项 |
| **快速校稿** | `/校稿 快速` | 日常更新 | 语法、逻辑、AI痕迹 |
| **深度去AI** | `/校稿 去AI` | AI生成优化 | 句式、对话、描写 |
| **精修润色** | `/校稿 精修` | 关键章节 | 意象、节奏、深度 |

### 检查项目
1. **语法与错别字** - 标点规范、"的地得"用法
2. **逻辑一致性** - 时间线、人物行为、伏笔回收
3. **节奏把控** - 场景切换、详略得当、章末钩子
4. **对话自然度** - 口语化、符合角色画像、潜台词
5. **描写生动性** - 五感描写、画面感、细节
6. **AI痕迹检测** - 对照 style_anchor.md 禁忌清单
7. **风格一致性** - 对照 style_anchor.md 风格DNA

### 去AI化核心原则
- 打破工整句式，长短句交替
- 口语化替代书面语
- 加入不完美细节和个人化感官
- 控制修辞密度，留白给读者
- 允许逻辑微小跳跃
- 参照 style_anchor.md 中的禁忌清单逐项检查

---

## 🔗 MCP 集成

| MCP 服务 | 用途 |
|----------|------|
| **Sequential** | 复杂剧情逻辑分析、一致性推理、审计 |
| **Context7** | 查询写作技巧、文学理论 |
| **Tavily** | 查找参考资料、对标作品信息 |

---

## 📌 注意事项

1. **Smart State 优先**：写前只需读 novel_plan.md + novel_state.md，按需读取追踪器
2. **知识库优先**：设定冲突时以知识库为准
3. **用户优先**：当用户明确要求修改设定时，更新知识库和记忆文件
4. **及时更新**：每章写完必须更新 novel_state.md，不可累积
5. **压缩及时**：达到压缩触发条件时立即执行摘要压缩
6. **风格锚定**：每10章执行一次风格校准，防止AI风格漂移
7. **章末钩子**：每章结尾必须设计读者留存钩子
8. **级联修改**：修改已写章节时必须级联更新所有受影响的记忆文件

---

## 📚 版本历史

### v5.1.0 (2026-02-13)
- 新增 Smart State 模式：novel_state.md 为唯一必读状态文件
- 优化 Pre-Write Protocol：2个必读 + 按需加载，减少70%读取量
- 新增 style_anchor.md：风格DNA + 角色对话画像 + 情感节奏图 + 禁忌清单
- 新增 /批量写作：连续多章生成，自动循环记忆协议
- 新增 /修改章节：章节修订 + 级联更新记忆文件 + 影响报告
- 新增 /风格校准：对比当前写作与风格锚点
- 新增章末钩子追踪机制
- novel_state.md 升级：新增情感节奏快照、风格提醒、章末钩子设计
- 校稿编辑器新增第7项检查：风格一致性（对照style_anchor）
- Post-Write 优化：仅更新受影响的追踪器，非全量更新

### v5.0.0 (2026-02-13)
- 新增文件级长期记忆系统（借鉴 planning-with-files）
- 新增三核心记忆文件：novel_plan / novel_state / novel_findings
- 新增四个追踪器：角色 / 时间线 / 伏笔 / 世界状态
- 新增滚动压缩章节摘要（L1/L2/L3三级）
- 新增 Pre-Write / Post-Write Protocol（强制钩子行为）
- 新增 2-Chapter Rule（双章审计）
- 新增 Session Recovery（会话恢复）

### v4.0.0
- 新增长期记忆概念设计（声明式）

### v3.0.0
- 新增校稿编辑器、去AI化功能

### v2.0.0
- 完整工作流系统、12个知识库模块

### v1.0.0
- 初始版本：四维拆书分析
